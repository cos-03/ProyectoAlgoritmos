(globalThis.webpackChunksearch_results_vue=globalThis.webpackChunksearch_results_vue||[]).push([[3473],{16869:(e,t,a)=>{"use strict";a.d(t,{bS:()=>l,k0:()=>i});var r=a(84611);const n="IMAGE_SEARCH_RESULTS",s="SEARCH_HISTORY",o=20;function i(e={},t=null){const a=t||Date.now().toString();return localStorage.setItem(n,JSON.stringify({[a]:e})),a}function c(){localStorage.removeItem(s,JSON.stringify([]))}async function l({searchQuery:e,searchRequestId:t,searchType:a}){const n=function(){const e=window?.gaData?.user?.myJstorUserID,t=e?.length>0;if(t)return{userId:e,isLoggedIn:t};const a=window.document?.cookie?.split("; ")?.filter((e=>e?.startsWith("UUID")))?.[0]?.split("=")[1];return{userId:a,isLoggedIn:t}}();if(n.userId&&e)try{let i=function(e){try{let t=JSON.parse(localStorage.getItem(s))||[];return e.isLoggedIn&&t.length>0&&(t[0]?.isLoggedIn&&t[0]?.userId!==e.userId?(c(),t=[]):t=t.map((t=>({...t,userId:e.userId,isLoggedIn:e.isLoggedIn})))),t}catch(e){return c(),[]}}(n);i.some((t=>t.searchQuery===e))?i=i.map((a=>(a.searchQuery===e&&(a.timestamp=Date.now(),a.searchRequestId=t,a.userId=n.userId,a.isLoggedIn=n.isLoggedIn),a))):i.push({timestamp:Date.now(),searchQuery:e,searchType:a,searchRequestId:t,userId:n.userId,isLoggedIn:n.isLoggedIn}),i.length>o&&(i=i.slice(-o)),n.isLoggedIn&&await(0,r.jB)(e),localStorage.setItem(s,JSON.stringify(i))}catch(e){console.error("Failed to update search history in localStorage:",e)}}},21837:(e,t,a)=>{"use strict";a.d(t,{v:()=>r});class r{constructor(e="#screen-reader-notification"){this.messageSelector=e,this._setupDOM()}_setupDOM(){if(!document.querySelector(`${this.messageSelector}`))throw new Error("Missing required container. Add div#screen-reader-notification with the correct ARIA attrs");this.$messageContainer=document.querySelector(`${this.messageSelector}`)}sendMessage(e){if(!e)throw new Error("Screen Reader Notification didn't receive a message to alert on");this.clearBuffer(),this.$messageContainer.append(`<span>${e}</span>`)}sendMessageFromPayload(e){this.sendMessage(`Search results updated ${function(e){if("string"==typeof e)return e;if("sort-by-changed"===e.type)return function(e){return`with sorting by ${{rel:"Relevance",old:"Oldest",new:"Newest",asc:"Title"}[e.event]}`}(e);if("access-type-toggle"===e.type)return"on"===e.event?.target.value?"with content I can access":"with all content";if("search-within"===e.type)return`with ${e.searchWithinQuery}`;if(e.startDate||e.endDate)return function(e){const t=e.startDate.length>0,a=e.endDate.length>0;return`${`${t?"with":"without"} start date ${e.startDate}`.trim()} and ${` ${a?"with":"without"} end date ${e.endDate}`.trim()}`}(e);if(e.event?.target){const t=function(e){let t=e.textContent;if(t.includes("(")){const e=t.indexOf("(");t=t.substring(0,e).trim()}return t}(e.event.target);return`${e.event.target.checked?"with":"without"} filter ${t}`}return""}(e)}`)}clearBuffer(){this.$messageContainer.innerHTML=""}}},26666:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var r=a(38616),n=a.n(r),s=a(38073),o=a.n(s)()(n());o.push([e.id,".mb-1x[data-v-fcd97870]{margin-bottom:1rem}.mb-3x[data-v-fcd97870]{margin-bottom:3rem}.mbn[data-v-fcd97870]{margin-bottom:none !important}.mbs[data-v-fcd97870]{margin-bottom:.5rem !important}.pal[data-v-fcd97870]{padding:2rem}.pas[data-v-fcd97870]{padding:.5rem}.align-center[data-v-fcd97870]{justify-content:center !important}.align-middle[data-v-fcd97870]{align-items:center}.no-bullet[data-v-fcd97870]{list-style:none}.link-no-underline[data-v-fcd97870]{text-decoration:none}.link-no-underline[data-v-fcd97870]:hover{text-decoration:underline}.hide-bg-color section#facet-filters[data-v-fcd97870]{background-color:rgba(0,0,0,0)}.top-tools[data-v-fcd97870]{display:grid;grid-template-columns:min-content 1fr;grid-template-rows:min-content min-content;grid-row-gap:.25rem;align-items:center;min-height:34px;background:#fff;transition:all .25s ease-in-out;padding:.5rem}.top-tools__heading[data-v-fcd97870]{grid-row:1/2;grid-column:1/3;margin-right:.5rem}.top-tools__heading-wrapper[data-v-fcd97870]{display:grid;grid-template-columns:repeat(2, auto);grid-gap:0}.top-tools__heading-wrapper .tooltip-trigger-icon[data-v-fcd97870]{cursor:pointer}.top-tools__buttons[data-v-fcd97870]{display:flex;grid-row:2/3;grid-column:1/3;column-gap:.75rem}.top-tools__clear[data-v-fcd97870]{grid-row:1/2;grid-column:4/5}.top-tools__links[data-v-fcd97870]{grid-column:5/6;display:inline-flex;column-gap:.5rem;justify-content:right}.top-tools__close[data-v-fcd97870]{display:none;position:absolute;right:1.5rem;top:20px}@media screen and (max-width: 48rem){.top-tools__close[data-v-fcd97870]{display:block}}.top-tools.out-of-view[data-v-fcd97870]{position:sticky;top:-100%;z-index:10}.top-tools.out-of-view.sticky[data-v-fcd97870]{box-shadow:rgba(18,18,18,.3) 0px 4px 4px -4px;top:0}@media screen and (min-width: 66rem){.top-tools[data-v-fcd97870]{grid-template-columns:min-content min-content min-content min-content auto;grid-template-rows:min-content min-content;grid-gap:1rem;grid-row-gap:.25rem;margin:0;padding-top:3rem}.top-tools__clear[data-v-fcd97870]{grid-column:4/5}.top-tools__buttons[data-v-fcd97870]{grid-row:1/2;grid-column:3/4}}@media screen and (max-width: 48rem){.top-tools.sticky .top-tools__clear[data-v-fcd97870]{display:none}}@media screen and (min-width: 48rem){.top-tools[data-v-fcd97870]{margin:0;padding:1rem 5rem;white-space:nowrap}}@media screen and (min-width: 85rem){.top-tools[data-v-fcd97870]{padding-top:3rem}}.top-tools.no-horizontal-padding[data-v-fcd97870]{padding:0 0 1rem 0;margin:0 0 1rem 0}.top-tools.sticky[data-v-fcd97870]{padding-top:1.5rem}@media screen and (max-width: 48rem){.top-tools.sticky[data-v-fcd97870]{padding-top:1rem}}@media screen and (min-width: 48rem){.genai-heading[data-v-fcd97870]{padding-left:1.5rem}}@media screen and (min-width: 66rem){.genai-heading[data-v-fcd97870]{padding-left:3rem}}@media screen and (max-width: 85rem){.genai-heading[data-v-fcd97870]{padding-right:3rem}}@media screen and (min-width: 48rem){.genai-heading-sticky[data-v-fcd97870]{margin-left:1.5rem;padding-left:2rem}}@media screen and (min-width: 66rem){.genai-heading-sticky[data-v-fcd97870]{margin-left:2rem;margin-right:4rem}}@media screen and (max-width: 85rem){.genai-heading-sticky[data-v-fcd97870]{margin-right:3rem}}.delimiter[data-v-fcd97870]{font-weight:initial}.search-heading[data-v-fcd97870]{margin-right:2rem}.top-tools-right[data-v-fcd97870]{padding:.5rem}@media screen and (min-width: 85rem){.top-tools-right[data-v-fcd97870]{padding-top:3rem}}.genai-search-toggle[data-v-fcd97870]{margin-right:1.5rem;display:flex}@media screen and (min-width: 48rem){.genai-search-toggle[data-v-fcd97870]{justify-content:flex-end}}",""]);const i=o},55578:(e,t,a)=>{"use strict";a.d(t,{Nv:()=>S,PL:()=>_});var r=a(11291),n=a(91583),s=a(98305),o=a(83204),i=a(79989),c=a(74014);function l(e){let t=[],a=[];for(let r=0;r<7;r++){const n=e.get(`q${r}`);if(!n)continue;const s=e.get(`f${r}`);if(r>0){const t=e.get(`c${r}`);a.push(t)}const o=s&&"all"!==s?`${s}:"${n}"`:n;t.push(o)}let r=t.reduce(((e,t,r)=>0===r?t:`(${e}) ${a.shift()} (${t})`),"");r&&(r=`(${r})`);const n=e.get("la");return n&&(r=`${r} AND la:(${n})`),r}function u(e,t=""){if(!e)return t;try{const a=JSON.parse(atob(decodeURIComponent(e)));return Object.keys(a).length>0?a:t}catch(e){return t}}function d(e){return{access:e.get("acc")||"",allowEmptyQuery:e.get("allowEmptyQuery")||"",efqs:u(e.get("efqs"),{}),endDate:e.get("ed")||"",filter:e.get("filter")||"",groupEfq:e.get("groupefq"),imageSearchReferrer:e.get("image_search_referrer")||"",pagemark:decodeURIComponent(e.get("pagemark")||""),prq:e.get("prq")||"",query:e.get("Query")||l(e),results_tab:e.get("results_tab")||"keyword",scope:u(e.get("scope"),null),searchKey:e.get("searchkey")||"",sort:e.get("so"),startDate:e.get("sd")||"",swp:e.get("swp"),theme:e.get("theme")||"",ymod:e.get("ymod")||""}}function p(e,t,a){return Object.entries(e).reduce(((e,[r,n])=>(r===t&&0===(n=n.filter((e=>-1===a.indexOf(e)))).length||(e[r]=n),e)),{})}function g(e){const t=function(e){const t=["new","old","item_title_str_asc","item_title_str_desc","primary_agents_str_asc","primary_agents_str_desc","cc_media_resolution_desc"];return e?["rel",...t]:t}(e.query);let a=["new","old"];return window.entity?.type?(a=["item_title_str_asc","new","old"],"container"===window.entity.type&&(a.push("sequence_number"),t.push("sequence_number"))):e.query&&a.unshift("rel"),{selected:e.sort||a[0],allContent:{options:a,default:a[0]},imageContent:{options:t,default:t[0]}}}function m(e,t){return e=function(e,t){const a=[];return(e?.find((e=>"content-type"===e?.comp_label))?.h_values||[]).forEach((e=>{const t=e.values?.filter((e=>e?.selected)).map((e=>e?.efq))||[];a.push(...t)})),t?.cty?.filter((e=>!a?.includes(e)))?.forEach((e=>{t=p(t,"cty",e)})),t}(t,e),e=function(e,t){const a=e?.find((e=>"classification"===e?.field))?.values.filter((e=>e?.selected))?.map((e=>e.efq))||[];return t?.classification?.forEach((e=>{a.includes(e)||(t=p(t,"classification",e))})),t}(t,e),e}var h=a(84611);function f(e,t){if(t)return["cty:(contributed_images OR contributed_panoramas)"];switch(e?.type){case"portal":return[`cc_portal_id: ${e.id}`];case"collection":return[`collection_ids: ${e.id}`];case"compilation":return[`cc_compilation_ids: ${e.id}`];case"container":return[`cc_container_id: ${e.id}`];case"journal":return[e.jcodes?.split(":").map((e=>`jcode:(${e})`)).join(" OR ")]}return[]}class v{constructor(e,t){this.context=e,this.event=t,this.hasImageSearchReferrer=Boolean(e.urlParamMap.imageSearchReferrer),this.facetFields=this.extractFacetFields(e.urlParamMap.efqs),this.pageType=this.determinePageType(e.urlParamMap.scope,this.hasImageSearchReferrer,t?.entityType),this.scopeFilterQueries=this.constructScopeFilterQueries(e.urlParamMap.scope,this.hasImageSearchReferrer,t),this.pageParams=this.constructPageParams(e.urlParamMap),this.isAdvancedSearch=this.checkAdvancedSearch(e),this.filterQueries=this.determineFilterQueries(this.scopeFilterQueries,t),this.advancedSearchEnrichments=t?.advancedSearchEnrichments||{},this.fullQuery=this.constructFullQuery(e.urlParamMap);const{sort:a,sortOrder:r}=this.determineSortOptions(e,t,e.urlParamMap.sort);this.sort=a,this.sortOrder=r,this.flagNamesTocheck=["genai_beta_search_results"]}extractFacetFields(e){return Object.entries(e).map((([e,t])=>({field:e,efq:t})))}determinePageType(e,t,a){return a||(0,i.M5)(e,t)}constructScopeFilterQueries(e,t,a){return e?f(e):a.entityType&&a.entityId?f({type:a.entityType,id:a.entityId}):[]}constructPageParams(e){const t={};return e.groupEfq&&(t.groupEfq=e.groupEfq),e.pagemark&&(t.pageMark=e.pagemark),t}checkAdvancedSearch(e){return window.location?.pathname?.startsWith("/action/doAdvancedSearch")||"advanced_image_search"===e.urlParamMap.imageSearchReferrer}determineFilterQueries(e,t){return e.length>0&&e||t.filterQueries||[]}constructFullQuery(e){let t=e.query;return e.prq&&(t=e.query?`(${e.query}) AND (${e.prq})`:`(${e.prq})`),t}determineSortOptions(e,t,a){let r,n;return a?.endsWith("_asc")||a?.endsWith("_desc")?(r=a.replace("_asc","").replace("_desc",""),n=a.endsWith("_asc")?"asc":"desc"):r=a||"rel",{sort:r,sortOrder:n}}getAllowEmptyQuery(e,t,a){const r=e.allowEmptyQuery||t.urlParamMap?.allowEmptyQuery||t.currentRequestArgs?.allowEmptyQuery,n=t.urlParamMap.imageSearchReferrer&&!a;return Boolean(r||n)}buildRequestArguments(){const e={acc:this.context.urlParamMap.access,allowEmptyQuery:this.getAllowEmptyQuery(this.event,this.context,this.fullQuery),endDate:this.context.urlParamMap.endDate,forwardedAdvancedSearchParams:{...this.context.forwardedAdvancedSearchParams,...this.advancedSearchEnrichments},getFlagNames:this.flagNamesTocheck,isAdvancedSearch:this.isAdvancedSearch,msFacetFields:this.facetFields,pageParams:this.pageParams,pageType:this.pageType,referer:document.referrer,refreqid:this.context.latestSearchRequestId,searchTerm:this.fullQuery,startDate:this.context.urlParamMap.startDate,theme:this.context.urlParamMap.theme,filterQueries:this.filterQueries,sort:this.sort,sortOrder:this.sortOrder,content_set_flags:this.context.urlParamMap.imageSearchReferrer?["contributed_images","contributed_panoramas"]:[]};return this.addCCDAPageSpecificParams(e)}isAnyFilterApplied(e){const t=e.msFacetFields?.filter((e=>e.efq?.length)).length>0,a=Boolean(e.startDate)||Boolean(e.endDate);return t||a}addCCDAPageSpecificParams(e){const t=this.event.entityType,a=this.event.entityId,r=this.isAnyFilterApplied(e),n={collection:{filter:`collection_ids: ${a}`,param:"contributed_content_container_mix"},compilation:{filter:`cc_compilation_ids: ${a}`,param:"contributed_content_container_mix"},container:{filter:`cc_container_id: ${a}`,param:"contributed_content_v1"}};return n[t]&&(e.allowEmptyQuery=!0,e.filterQueries=[n[t].filter],e.forwardedAdvancedSearchParams=r?{}:{[n[t].param]:!0}),e}buildLogData(e){return{referring_requestid:e,action:"viewAllClicked"===this.event.action?"search_results_image_carousel_view_more_clicked":"image_search",event_type:"image_search",page_type:this.pageType,query:this.fullQuery,page_type_id:this.context.urlParamMap.scope?.id||this.event.entityId||""}}async submitRequest(){let e;const t=this.buildRequestArguments(),a=this.buildLogData(window.requestId);if("experimental"===this.context.searchType){const t=await(0,h.b1)({query:this.fullQuery,getFlagNames:this.flagNamesTocheck,pageType:this.pageType,referer:document.referrer,refreqid:this.context.latestSearchRequestId}),a=t.results?.length||0;e={acc:"on",searchQuery:this.fullQuery,errors:[],facets:[],groupedResults:{column1:{comp_label:"component_set",results:[{comp_label:"search-results-list",group_efq:"",results:t.results,paging:{next:"",page_start_index:1,page_end_index:1,total_results:a,page_index:1,total_pages:1,group_efq:""}}]}},notices:[],requestId:t.requestid,spelling_suggestions:{},totalResultCount:a,requestedFlags:t?.requestedFlags||{}}}else e=await(0,h.p5)(t,a);return{results:e,requestArgs:t}}}var y=a(16869);const w=(0,r.createActor)(function(){const e=d(new URLSearchParams(window.location.search)),t=(0,i.uo)(),a=Object.keys(t).length>0?{...t}:{},n=function(e){return window?.enableSemanticSearch&&"experimental"===e?.results_tab?"experimental":"keyword"}(e);return(0,r.createMachine)({id:"search",initial:"idle",context:{currentRequestArgs:{},errors:[],facets:[],forwardedAdvancedSearchParams:a,groupedResults:{},loading:!0,notices:[],requestId:null,searchFlags:{},searchQuery:"",searchType:n,sortOptions:g(e),spellingSuggestions:[],totalResultCount:0,topLevelAbSegment:"",urlParamMap:e,experimentalSearchEnabled:window.enableSemanticSearch,experimentalSearchRequestId:"",experimentalSearchResults:{},experimentalSearchTotalResultCount:0,enableGenAIBeta:window.enableGenAIBetaSearchResults,toggleGenAiBeta:!1,isSearchTypeExperimental:"experimental"===n,isSearchTypeKeyword:"keyword"===n,latestSearchRequestId:window.referringRequestId,searchResultsToDisplay:{}},states:{idle:{on:{RUN_SEARCH:{actions:"setSortOptions",target:"searching"},SEARCH:{actions:["resetUrlParams","updateQuery","setSortOptions"],target:"searching"},NEXT_PAGE:{actions:["nextPage","logNextPageChange"],target:"searching"},PREVIOUS_PAGE:{actions:["previousPage","logPreviousPageChange"],target:"searching"},SELECT_EFQ:{actions:["removePagingParams","addEfq","dispatchScopeChange","setSortInUrlParamMap","setSortOptions"],target:"searching"},DESELECT_EFQ:{actions:["removeEfq","removePagingParams","dispatchScopeChange","setSortInUrlParamMap","setSortOptions"],target:"searching"},RESET_FACETS:{actions:["resetForwardedAdvancedSearchParams","resetUrlParams","setSortOptions"],target:"searching"},CLEAR_PAGING_PARAMS:{actions:["removePagingParams","setSortOptions"],target:"searching"},DATE:{actions:["removePagingParams","selectDate"],target:"searching"},ACCESS:{actions:["removePagingParams","selectAccess"],target:"searching"},SET_ACCESS:{actions:"setAccess",target:"searching"},SET_SEARCH_KEY:{actions:"setSearchKey"},SORT_ORDER:{actions:["removePagingParams","setSortInUrlParamMap","setSortOptions"],target:"searching"},SET_INITIAL_SORT_OPTIONS:{actions:["setSortInUrlParamMap","setSortOptions"]},GROUP_EFQ:{actions:"selectGroupEfq",target:"searching"},SEARCH_WITHIN:{actions:["resetForwardedAdvancedSearchParams","removePagingParams","selectSearchWithin","dispatchScopeChange"],target:"searching"},BACKFORWARD:{actions:"reparseParams"},SET_EXPERIMENTAL_SEARCH_TAB:[{actions:"setExperimentalSearchTab",target:"searching",guard:"shouldRequestResults"},{actions:"setExperimentalSearchTab",target:"idle"}],SET_TOGGLE_GENAI_BETA:{actions:"setToggleGenaiBeta"}}},searching:{entry:["clearSearchKey","enterSearching"],exit:"exitSearching",invoke:{src:(0,r.fromPromise)((async({input:e})=>{const t=new v(e.context,e.event);return await t.submitRequest()})),input:({context:e,event:t})=>({context:e,event:t}),onDone:[{target:"idle",actions:["setExperimentalSearchResponse","setSearchResultsToDisplay","updateLocalStorageSearchHistory","logGAEvent"],guard:"isExperimentalSearch"},{target:"idle",actions:["setResponse","setSearchResultsToDisplay","updateLocalStorageSearchHistory","logGAEvent"]}]}}}},{guards:{shouldRequestResults:({context:e,event:t})=>"experimental"===t.value?!(e.experimentalSearchResults?.column1?.results?.[0]?.results?.length>0):!(e.groupedResults?.column1?.results?.[0]?.results?.length>0),isExperimentalSearch:({context:e})=>!0===e.isSearchTypeExperimental},actions:{clearSearchKey:(0,r.assign)({urlParamMap:({context:e})=>({...e.urlParamMap,searchKey:""})}),enterSearching:(0,r.assign)({loading:()=>!0}),exitSearching:(0,r.assign)({loading:()=>!1}),setResponse:(0,r.assign)({currentRequestArgs:({event:e})=>e.output.requestArgs,errors:({event:e})=>e.output.results.errors,facets:({event:e})=>e.output.results.facets,groupedResults:({event:e})=>e.output.results.groupedResults,latestSearchRequestId:({event:e})=>e.output.results.requestId,notices:({event:e})=>e.output.results.notices,requestId:({event:e})=>e.output.results.requestId,searchFlags:({event:e})=>e.output.results.requestedFlags,searchQuery:({event:e})=>e.output.results.searchQuery,spellingSuggestions:({event:e})=>e.output.results.spelling_suggestions,topLevelAbSegment:({event:e})=>e.output.results.ab_segment,totalResultCount:({event:e})=>e.output.results.totalResultCount,urlParamMap:({context:e,event:t})=>({...e.urlParamMap,access:t.output.results.acc})}),setExperimentalSearchResponse:(0,r.assign)({experimentalSearchRequestId:({event:e})=>e.output.results.requestId,experimentalSearchResults:({event:e})=>e.output.results.groupedResults,experimentalSearchTotalResultCount:({event:e})=>e.output.results.totalResultCount,latestSearchRequestId:({event:e})=>e.output.results.requestId,searchQuery:({event:e})=>e.output.results.searchQuery,errors:({event:e})=>e.output.results.errors}),logNextPageChange:()=>{(0,c.S)({action:"paginate_link_clicked",event_type:"search_results_next_page_clicked",referring_requestid:window.requestId,uri:window.location.href})},logPreviousPageChange:()=>{(0,c.S)({action:"paginate_link_clicked",event_type:"search_results_prev_page_clicked",referring_requestid:window.requestId,uri:window.location.href})},logGAEvent:({context:e})=>{const t=e.searchResultsToDisplay?.column1?.results?.filter((e=>"carousel"!==e.comp_label));if(t?.length){const a=t[0]?.paging?.page_index||"page_index undefined",r=`${t.some((e=>"image-results-matrix"===e.comp_label))?"Image":"All Content"} Search - Page ${a}`;window?.dataLayer?.push({event:"refineSearchResults",action:r,label:e.searchQuery})}},nextPage:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=(0,s.updateUrlParameter)(window.location.href,"pagemark",t.value);return t.groupEfq&&(a=(0,s.updateUrlParameter)(a,"groupefq",t.groupEfq)),window.history.pushState({},document.title,a),{...e.urlParamMap,pagemark:t.value,groupEfq:t.groupEfq}}}),previousPage:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=window.location.href;return a=t.value?(0,s.updateUrlParameter)(a,"pagemark",t.value):(0,s.removeUrlParameters)(a,["pagemark"]),a=t.groupEfq?(0,s.updateUrlParameter)(a,"groupefq",t.groupEfq):(0,s.removeUrlParameters)(a,["groupefq"]),window.history.pushState({},document.title,a),{...e.urlParamMap,pagemark:t.value,groupEfq:t.groupEfq}}}),updateQuery:(0,r.assign)({urlParamMap:({context:e,event:t})=>{const a=(0,s.updateUrlParameter)(window.location.href,"Query",t.value.replace(/ /g,"+"));return window.history.pushState({},document.title,a),{...e.urlParamMap,query:t.value}}}),removePagingParams:(0,r.assign)({urlParamMap:({context:e})=>{const t=["pagemark"],a=1===e.groupedResults?.column1?.results?.length&&"image-results-matrix"===e.groupedResults?.column1?.results[0]?.comp_label,r=e.urlParamMap.filter?.length>0,n=Object.keys(e.urlParamMap.efqs)?.length>0,o=!a&&!r&&!n;o&&t.push("groupefq");const i=(0,s.removeUrlParameters)(window.location.href,t);return window.history.replaceState({},document.title,i),{...e.urlParamMap,pagemark:null,groupEfq:o?null:e.urlParamMap.groupEfq}}}),selectSearchWithin:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=window.location.href,r="";const n=t.value;var o;return e.urlParamMap.query&&e.urlParamMap.prq&&(r=`(${o=e.urlParamMap.query,o.match(/^\(.*\)$/)?o.substring(1,o.length-1):o}) AND (${e.urlParamMap.prq})`,a=(0,s.updateUrlParameter)(a,"Query",r)),a=(0,s.updateUrlParameter)(a,"prq",n.replace(/ /g,"+")),a=(0,s.updateUrlParameter)(a,"swp","on"),window.history.pushState({},document.title,a),{...e.urlParamMap,query:r||e.urlParamMap.query,prq:t.value,forwardedAdvancedSearchParams:{}}}}),dispatchScopeChange:()=>window.dispatchEvent(new CustomEvent("mfe-query-builder:change-scope")),addEfq:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=e.urlParamMap.efqs;t.remove?.length>0&&(a=p(a,t.key,t.remove)),a[t.key]||(a[t.key]=[]),a[t.key]=Array.isArray(t.value)?[...a[t.key],...t.value]:[...a[t.key],t.value];const r=(0,s.updateUrlParameter)(window.location.href,"efqs",btoa(JSON.stringify(a)));return window.history.pushState({},document.title,r),{...e.urlParamMap,efqs:a}}}),removeEfq:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=p(e.urlParamMap.efqs,t.key,[t.value]);a=m(a,e.facets);const r=Object.values(a).flat().length>0?(0,s.updateUrlParameter)(window.location.href,"efqs",btoa(JSON.stringify(a))):(0,s.removeUrlParameters)(window.location.href,["efqs"]);return window.history.pushState({},document.title,r),{...e.urlParamMap,efqs:a}}}),setSortInUrlParamMap:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=t.value;if(["SELECT_EFQ","DESELECT_EFQ"].includes(t.type)&&(a=e.urlParamMap.sort||e.sortOptions.selected,function(e,t){if("SORT_ORDER"===t.type)return!1;const a=e.urlParamMap?.efqs?.cty||[],r=a.filter((e=>["contributed_images","contributed_panoramas"].includes(atob(e)))).length,n=a.length>0&&a.length===r&&a.length<3,s=["_asc","_desc"].some((t=>e.urlParamMap?.sort?.endsWith(t))),o=!e.sortOptions.allContent.options.includes(e.urlParamMap.sort);return!n&&s&&o}(e,t))){const t=Number(e.urlParamMap?.efqs?.cty?.filter((e=>["contributed_images","contributed_panoramas"].includes(atob(e))))?.length);a=Boolean(e.urlParamMap?.efqs.cty?.length&&e.urlParamMap?.efqs.cty?.length===t&&e.urlParamMap?.efqs.cty?.length<3)?e.sortOptions.imageContent.default:e.sortOptions.allContent.default}const r=(0,s.updateUrlParameter)(window.location.href,"so",a);return"SET_INITIAL_SORT_OPTIONS"===t.type?window.history.replaceState({},document.title,r):window.history.pushState({},document.title,r),{...e.urlParamMap,sort:a}}}),selectGroupEfq:(0,r.assign)({urlParamMap:({context:e,event:t})=>{const a=(0,s.updateUrlParameter)(window.location.href,"groupefq",t.value);return window.history.pushState({},document.title,a),{...e.urlParamMap,groupEfq:t.value}}}),selectDate:(0,r.assign)({urlParamMap:({context:e,event:t})=>{let a=window.location.href;return a=t.startDate?(0,s.updateUrlParameter)(a,"sd",t.startDate):(0,s.removeUrlParameters)(a,["sd"]),a=t.endDate?(0,s.updateUrlParameter)(a,"ed",t.endDate):(0,s.removeUrlParameters)(a,["ed"]),window.history.pushState({},document.title,a),{...e.urlParamMap,startDate:t.startDate,endDate:t.endDate}}}),selectAccess:(0,r.assign)({urlParamMap:({context:e,event:t})=>{const a=t.access?(0,s.updateUrlParameter)(window.location.href,"acc",t.access):(0,s.removeUrlParameters)(window.location.href,["acc"]);return window.history.pushState({},document.title,a),{...e.urlParamMap,access:t.access}}}),setAccess:(0,r.assign)({urlParamMap:({context:e,event:t})=>({...e.urlParamMap,access:t.value})}),setSearchKey:(0,r.assign)({urlParamMap:({context:e,event:t})=>{const a=(0,s.updateUrlParameter)(window.location.href,"searchkey",t.value);return window.history.replaceState({},document.title,a),{...e.urlParamMap,searchKey:t.value}}}),reparseParams:(0,r.assign)({urlParamMap:()=>d(new URLSearchParams(window.location.search))}),resetUrlParams:(0,r.assign)({urlParamMap:({context:e})=>{const t=["efqs","acc","sd","ed","so","sort","groupefq","pagemark","searchkey","image_search_referrer","prq","swp"];!(e.urlParamMap.scope&&e.urlParamMap.scope.type?.length>0)&&!e.urlParamMap.imageSearchReferrer&&t.push("allowEmptyQuery");const a=(0,s.removeUrlParameters)(window.location.href,t);return window.history.pushState({},document.title,a),d(new URLSearchParams(window.location.search))}}),setSortOptions:(0,r.assign)({sortOptions:({context:e})=>g(e.urlParamMap)}),setSearchResultsToDisplay:(0,r.assign)({searchResultsToDisplay:({context:e})=>e?.isSearchTypeExperimental?e.experimentalSearchResults:e.groupedResults}),resetForwardedAdvancedSearchParams:(0,r.assign)({forwardedAdvancedSearchParams:()=>({})}),setToggleGenaiBeta:(0,r.assign)({toggleGenAiBeta:({event:e})=>e.value}),setExperimentalSearchTab:(0,r.assign)({urlParamMap:({context:e,event:t})=>{const a=(0,s.updateUrlParameter)(window.location.href,"results_tab",t.value);return window.history.replaceState({},document.title,a),{...e.urlParamMap,results_tab:t.value}},searchType:({event:e})=>"experimental"===e?.value?"experimental":"keyword",isSearchTypeExperimental:({event:e})=>"experimental"===e?.value,isSearchTypeKeyword:({event:e})=>"keyword"===e?.value,searchResultsToDisplay:({context:e,event:t})=>"experimental"===t?.value?e.experimentalSearchResults:e.groupedResults,latestSearchRequestId:({context:e,event:t})=>"experimental"===t?.value?e.experimentalSearchRequestId:e.requestId}),updateLocalStorageSearchHistory:async({context:e})=>{await(0,y.bS)({searchQuery:e.searchQuery,searchRequestId:e.latestSearchRequestId,searchType:e.searchType})}}})}()).start();function S(e,t){return(0,n.useSelector)(e,(e=>(0,o.A)(e.context,t)))}function _(){return w}window.addEventListener("popstate",(()=>{w.send({type:"BACKFORWARD"})}))},69672:(e,t,a)=>{"use strict";a.d(t,{FM:()=>h,LQ:()=>g,re:()=>m,sp:()=>p});var r=a(11291),n=a(91583),s=a(36292),o=a(83204),i=a(27795);const c=new i.CaptainsLogger("srchx","search-results-vue"),l=(e,t)=>{c.log({eventType:e,enrichments:[new i.SessionEnrichment],additionalFields:{page_name:"search",bulkActionSession:t}})},u=(0,r.createMachine)({id:"select",initial:"idle",context:{bulkActionSession:null,selected:[],showWarning:!1,warningConfirmationCallback:null},states:{idle:{on:{SELECT:{actions:(0,r.enqueueActions)((({enqueue:e})=>{e("startBulkSession"),e("logStartBulkSession"),e("select")})),target:"selecting"}}},selecting:{always:[{target:"idle",guard:"noSelection",actions:(0,r.enqueueActions)((({enqueue:e})=>{e("logEndBulkSession"),e("endBulkSession")}))}],on:{SELECT:{actions:"select"},DESELECT:{actions:"deselect"},CLEAR:{actions:"clear"},WARN:{target:"warning",actions:"setWarning"}}},warning:{on:{CANCEL:{target:"selecting",actions:"clearWarning"},CONFIRM:{target:"idle",actions:(0,r.enqueueActions)((({enqueue:e})=>{e("clear"),e("runConfirmCallback"),e("clearWarning")}))}}}}},{guards:{noSelection:({context:e})=>0===e.selected.length},actions:{select:(0,r.assign)({selected:({context:e,event:t})=>[...e.selected,t.id]}),deselect:(0,r.assign)({selected:({context:e,event:t})=>e.selected.filter((e=>t.id!==e))}),clear:(0,r.assign)({selected:[]}),startBulkSession:(0,r.assign)({bulkActionSession:()=>(0,s.v4)()}),endBulkSession:(0,r.assign)({bulkActionSession:null}),logStartBulkSession:({context:e})=>{l("enter_bulk_action",e.bulkActionSession)},logEndBulkSession:({context:e})=>{l("exit_bulk_action",e.bulkActionSession)},setWarning:(0,r.assign)({showWarning:!0,warningConfirmationCallback:({event:e})=>e.callback}),clearWarning:(0,r.assign)({showWarning:!1,warningConfirmationCallback:null}),runConfirmCallback:({context:e})=>{"function"==typeof e.warningConfirmationCallback&&e.warningConfirmationCallback()}}}),d=(0,r.createActor)(u).start();function p(e,t){return(0,n.useSelector)(e,(e=>e.context.selected.includes(t)))}function g(e){return(0,n.useSelector)(e,(e=>e.value))}function m(e,t){return(0,n.useSelector)(e,(e=>(0,o.A)(e.context,t)))}function h(){return d}},77480:(e,t,a)=>{var r=a(26666);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);(0,a(59781).A)("98b19b1c",r,!1,{})},79989:(e,t,a)=>{"use strict";a.d(t,{H0:()=>i,JE:()=>n,M5:()=>o,PB:()=>l,S0:()=>s,mH:()=>d,oA:()=>c,uo:()=>u});var r=a(98305);function n(e){let t=window.location.href;Object.entries(e).forEach((([e,a])=>{var n,s,o;n=t,s=e,t=(o=a)?(0,r.updateUrlParameter)(n,s,o):(0,r.removeUrlParameters)(n,[s])})),window.history.pushState({},document.title,t)}function s(e){return encodeURIComponent(btoa(JSON.stringify(e)))}function o(e=null,t=!1){let a="basic_search_page";const n=window.location?.pathname,s=n?.startsWith("/action/doAdvancedSearch")||window.document?.referrer?.endsWith("/action/showAdvancedSearch");return e&&e.type?a=e.type:t?a=(0,r.getFormattedParamValue)("image_search_referrer"):s&&(a="advanced_search_page"),a}function i(e){const t=(0,r.removeUrlParameters)(window.location.href,[e]);window.history.replaceState({},document.title,t)}function c(e,t){const a=(0,r.updateUrlParameter)(window.location.href,e,t,!0);window.history.replaceState({},document.title,a)}function l(e){let t=window.location.href;e.add&&e.add.forEach((e=>{Object.entries(e).forEach((([e,a])=>{t=(0,r.updateUrlParameter)(t,e,a,!0)}))})),e.remove&&(t=(0,r.removeUrlParameters)(t,e.remove)),e.update&&e.update.forEach((e=>{Object.entries(e).forEach((([e,a])=>{t=(0,r.updateUrlParameter)(t,e,a,!0)}))})),window.history.replaceState({},document.title,t),function(){const e=new CustomEvent("mfe-query-builder:change-scope");window.dispatchEvent(e)}()}function u(){if(!window.location.search)return{};const e=window.location.search.replace("?","").split("&"),t={};for(const a of e){const e=a.split("=");t[e[0]]=decodeURIComponent(e[1])}return t}function d(e,t){const a=(0,r.getFormattedParamValue)("pagemark")||null;if(a){return{decodedPageMark:JSON.parse(atob(a)),encodedPageMark:a}}if(e&&t){const a={page:e,starts:{JSTORBasic:t}};return{decodedPageMark:a,encodedPageMark:btoa(JSON.stringify(a))}}return{}}},80029:(e,t,a)=>{"use strict";a.d(t,{A:()=>P});var r=a(33898),n=a(69714),s=a(73223),o=a(69672),i=a(58653);const c={ref:"genAIMobileSheetButtonMountPoint"};const l={name:"GenAIMobileSheetButton",async mounted(){const e=await(0,s.loadRegisteredModule)("mfeGenaiBeta/MfeGenaiBeta");e?.mountMobileSheetButton&&e.mountMobileSheetButton(this.$refs.genAIMobileSheetButtonMountPoint,{isBetaUserAndNotLoggedIn:!1,pageType:"search_results_page"})}};var u=a(30978);const d=(0,u.A)(l,[["render",function(e,t,a,n,s,o){return(0,r.openBlock)(),(0,r.createElementBlock)("div",c,null,512)}]]),p={ref:"genAIToggleMountPoint",class:"genai-search-toggle","data-qa":"genai-search-toggle"};var g=a(55578);const m={name:"GenAIBetaToggle",setup(){const e=(0,g.PL)();return{genaiBetaToggle:(0,g.Nv)(e,"toggleGenAiBeta"),searchService:e}},async mounted(){const e=await(0,s.loadRegisteredModule)("mfeGenaiBeta/MfeGenaiBeta");this.$refs.genAIToggleMountPoint&&e.mountToggle(this.$refs.genAIToggleMountPoint,{enabled:this.genaiBetaToggle,isBetaUserAndNotLoggedIn:!1,toggleCallback:e=>{this.searchService.send({type:"SET_TOGGLE_GENAI_BETA",value:e})}})}},h=(0,u.A)(m,[["render",function(e,t,a,n,s,o){return(0,r.openBlock)(),(0,r.createElementBlock)("div",p,null,512)}]]),f=["preset"],v={class:"top-tools__heading-wrapper"},y=["innerHTML"],w={class:"top-tools__buttons"},S={key:3,class:"top-tools__links"},_={__name:"SearchResultsHeading",props:{resultTypeText:{type:String,default:"result"},currentPage:{type:Number,default:1},totalResultCount:{type:Number,default:0},isImageGrid:{type:Boolean,default:!1},displayExperimentalSearchToggle:{type:Boolean,default:!1},isSearchTypeExperimental:{type:Boolean,default:!1},isGenaiChatEnabled:{type:Boolean,default:!1}},setup(e){(0,i.X)(["pharos-tooltip","pharos-toggle-button-group","pharos-toggle-button"]);const t=(0,r.defineAsyncComponent)((()=>a.e(7109).then(a.bind(a,37641)))),c=(0,r.defineAsyncComponent)((()=>a.e(1843).then(a.bind(a,81843)))),l=e,u=(0,r.inject)("captainsLog"),p=(0,o.FM)(),g=(0,o.LQ)(p),m=(0,o.re)(p,"selected"),_=(0,o.re)(p,"bulkActionSession"),P=window.location.pathname.startsWith("/action/doAdvancedSearch"),k=(0,r.ref)(null),E=(0,r.ref)(!1),b=(0,r.ref)(null),q=(0,r.ref)(null),x=(0,r.ref)(null),R=(0,r.ref)(null),A=(0,r.ref)(window.innerWidth),M=(0,r.computed)((()=>A.value<=768)),C=()=>{A.value=window.innerWidth},T=(0,r.computed)((()=>["selecting","warning"].includes(g.value))),I=(0,r.computed)((()=>l.totalResultCount.toLocaleString())),B=(0,r.computed)((()=>(0,n.t)(l.resultTypeText,l.totalResultCount))),O=(0,r.computed)((()=>E.value&&T.value&&!M.value)),N=(0,r.computed)((()=>O.value?"2--bold":"5--bold")),D=(0,r.computed)((()=>l.displayExperimentalSearchToggle&&!T.value)),U=(0,r.computed)((()=>l.isGenaiChatEnabled&&l.isSearchTypeExperimental&&l.totalResultCount>0&&M.value)),$=(0,r.computed)((()=>l.isGenaiChatEnabled&&D.value&&l.isSearchTypeExperimental&&l.totalResultCount>0&&!M.value)),L=(0,r.computed)((()=>0===I.value?.length?"":T.value?l.isImageGrid||1===l.currentPage?`${m.value.length} selected`:`Page ${l.currentPage} <span class="delimiter">âˆ™</span> ${m.value.length} selected`:!l.isImageGrid&&l.currentPage>1?`Page ${l.currentPage} of ${I.value} results`:I.value?l.isSearchTypeExperimental?`Top ${I.value} ${B.value}`:`${I.value} ${B.value}`:""));function Q(){p.send({type:"CLEAR"})}function F(e){u({event_type:e,action:"search_results_header_link_clicked",referring_requestid:window.requestId,uri:window.location.href})}function G(){const e=(0,r.useAttrs)(),t=E.value?"out-of-view":"",a=O.value?"sticky":"";let n=l.isGenaiChatEnabled&&!M.value?"genai-heading":"";n&&E.value&&O.value&&(n="genai-heading-sticky");return["top-tools",...[e.class,t,a,n]].filter(Boolean).join(" ")}return(0,r.onMounted)((async()=>{if(window.addEventListener("resize",C),k.value=new IntersectionObserver((([e])=>{E.value=e.intersectionRatio<1}),{threshold:1}),k.value.observe(b.value),q.value){const e=await(0,s.loadRegisteredModule)("mfeBulkCite/MfeBulkCite");R.value=await(e?.mountBulkCite(q.value)),(0,r.watch)((()=>m.value),(e=>{R.value?.setBulkExport(e,_.value)}),{immediate:!0}),document.addEventListener("bulk-action-completed",(()=>{p.send({type:"CLEAR"})}))}if(x.value){const e=await(0,s.loadRegisteredModule)("mfeBulkSaveToWorkspace/MfeBulkSaveToWorkspace");await e.mount(x.value,{bulkSelectSessionCallback:()=>({contentIds:m.value,bulkActionSession:_.value})})}})),(0,r.onUnmounted)((()=>{window.removeEventListener("resize",C)})),(a,n)=>((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createElementVNode)("a",{id:"searchResults","data-qa":"skip-to-filters",href:"#",class:"visuallyhidden",onClick:n[0]||(n[0]=e=>(e.preventDefault(),void document.querySelector("a[data-qa='skip-to-results']").focus()))}," This is the search results section. Skip to search filters section. "),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(G()),"data-qa":"search-results-top-tools"},[I.value?.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("search-results-vue-pharos-heading",{key:0,class:"top-tools__heading","no-margin":"",level:1,preset:N.value,"data-qa":"search-results-count-tools"},[(0,r.createElementVNode)("div",v,[(0,r.createElementVNode)("div",{innerHTML:L.value},null,8,y)])],8,f)):(0,r.createCommentVNode)("v-if",!0),(0,r.withDirectives)((0,r.createElementVNode)("div",w,[(0,r.createElementVNode)("div",{ref_key:"bulkCiteMountPoint",ref:q},null,512),(0,r.createElementVNode)("div",{ref_key:"bulkSaveMountPoint",ref:x},null,512)],512),[[r.vShow,T.value]]),T.value?((0,r.openBlock)(),(0,r.createElementBlock)("search-results-vue-pharos-link",{key:1,class:"top-tools__clear",onClick:Q}," Clear selections ")):(0,r.createCommentVNode)("v-if",!0),O.value?((0,r.openBlock)(),(0,r.createElementBlock)("search-results-vue-pharos-button",{key:2,class:"top-tools__close",variant:"subtle",icon:"close","a11y-label":"Close",onClick:Q})):(0,r.createCommentVNode)("v-if",!0),(0,r.unref)(P)||!T.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",S,[(0,r.unref)(P)?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(c),{key:0,onClick:n[1]||(n[1]=e=>F("search_results_modify_search_link"))})):(0,r.createCommentVNode)("v-if",!0),T.value?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("search-results-vue-pharos-link",{key:1,href:"https://support-jstor-org.crai.referencistas.com/hc/en-us/articles/115004701828-Searching-A-Practical-Overview","data-sc":"text link: search help","data-qa":"search-help-link",class:"top-tools__search-help",target:"_blank",onClick:n[2]||(n[2]=e=>F("search_results_search_help_link"))}," Search help "))])):(0,r.createCommentVNode)("v-if",!0),D.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(t),{key:4})):(0,r.createCommentVNode)("v-if",!0)],2),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)({"top-tools-right":$.value||U.value})},[$.value?((0,r.openBlock)(),(0,r.createBlock)(h,{key:0})):(0,r.createCommentVNode)("v-if",!0),e.isGenaiChatEnabled?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:1},[(0,r.createCommentVNode)(" Use 'v-show' so it's in the DOM before the sheet, it's required before mounting to setup click listener "),(0,r.withDirectives)((0,r.createVNode)(d,null,null,512),[[r.vShow,U.value]])],64)):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",{ref_key:"anchor",ref:b},null,512)],2)],64))}};a(77480);const P=(0,u.A)(_,[["__scopeId","data-v-fcd97870"]])},84611:(e,t,a)=>{"use strict";a.d(t,{WT:()=>o,b1:()=>c,jB:()=>l,p5:()=>n,rz:()=>s,tl:()=>i});var r=a(74014);async function n(e,t={}){try{const a=await fetch("/search-results/grouped-search/",{credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),method:"POST",mode:"cors"}),n=await(a?.json());return(0,r.S)({requestid:n?.requestId,total_items:n?.totalResultCount,referring_requestid:window.referringRequestId,uri:window.location.href,referrer:document.referrer,...t}),n}catch(e){return e}}async function s(e,t){if(!e?.length)return Promise.resolve({results:[],errors:[]});try{const a=await fetch("/search-results/snippets/",{credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({snippetParams:JSON.stringify({items:e,query:t})}),method:"POST",mode:"cors"});return await(a?.json())}catch(e){return Promise.resolve({results:[],errors:[]})}}async function o(){const e=await fetch("/searchui/disciplines/");return await e.json()}async function i(e){const t=await fetch(`/searchui/journals/?code=${e}`);return await t.json()}async function c(e){try{const t=await fetch("/search-results/hybrid-search/",{credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),method:"POST",mode:"cors"});return await t.json()}catch(e){return e}}async function l(e){try{const t=await fetch("/updateUserSearchHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,action:"ADD"})});return await t.json()}catch(e){return e}}}}]);